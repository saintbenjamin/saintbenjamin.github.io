

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>controller.ui.emergency_caption_dialog &mdash; EuljiroWorship 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            EuljiroWorship
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">EuljiroWorship</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">controller.ui.emergency_caption_dialog</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for controller.ui.emergency_caption_dialog</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:File: EuljiroWorship/controller/ui/emergency_caption_dialog.py</span>

<span class="sd">Emergency caption input dialog (PySide6).</span>

<span class="sd">This module defines a dialog used by the slide controller to generate emergency</span>
<span class="sd">slides on demand. It supports the following workflows:</span>

<span class="sd">1. Bible reference lookup</span>
<span class="sd">    - User enters a reference string (e.g., &quot;요 3:16&quot;) and presses Enter.</span>
<span class="sd">    - The dialog previews resolved verse text via ``EmergencySlideFactory``.</span>
<span class="sd">    - Pressing Enter again (or confirming) finalizes the generated slides.</span>

<span class="sd">2. Keyword search</span>
<span class="sd">    - User enters a keyword query and chooses a search mode:</span>
<span class="sd">        - AND mode: all tokens must appear</span>
<span class="sd">        - Compact mode: whitespace-insensitive substring match</span>
<span class="sd">    - Results are shown in a table; double-clicking a result selects it.</span>

<span class="sd">If the first input is not recognized as a Bible reference, the dialog can also</span>
<span class="sd">build non-Bible emergency slides using a selected slide style (e.g., lyrics,</span>
<span class="sd">hymn, respo) and optional preset numbers.</span>

<span class="sd">The dialog returns a list of slide dictionaries via ``get_final_slides()``,</span>
<span class="sd">ready to be written to the slide output file and broadcast by the controller.</span>

<span class="sd">:Author: Benjamin Jaedon Choi - https://github.com/saintbenjamin</span>
<span class="sd">:Affiliated Church: The Eulji-ro Presbyterian Church [대한예수교장로회(통합) 을지로교회]</span>
<span class="sd">:Address: The Eulji-ro Presbyterian Church, 24-10, Eulji-ro 20-gil, Jung-gu, Seoul 04549, South Korea</span>
<span class="sd">:Telephone: +82-2-2266-3070</span>
<span class="sd">:E-mail: euljirochurch [at] G.M.A.I.L. (replace [at] with @ and G.M.A.I.L as you understood.)</span>
<span class="sd">:License: MIT License with Attribution Requirement (see LICENSE file for details); Copyright (c) 2025 The Eulji-ro Presbyterian Church.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> 
    <span class="n">QTextEdit</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> 
    <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> 
    <span class="n">QRadioButton</span><span class="p">,</span> <span class="n">QButtonGroup</span><span class="p">,</span> <span class="n">QTableView</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTextCursor</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">controller.utils.emergency_slide_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmergencySlideFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">controller.utils.keyword_highlight_delegate</span><span class="w"> </span><span class="kn">import</span> <span class="n">KeywordHighlightDelegate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">controller.utils.keyword_result_model_light</span><span class="w"> </span><span class="kn">import</span> <span class="n">KeywordResultTableModelLight</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">paths</span><span class="p">,</span> <span class="n">style_map</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core.generator.utils.icon_helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_svg_icon</span><span class="p">,</span> <span class="n">get_icon_path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core.utils.bible_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_reference</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core.utils.bible_keyword_searcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">BibleKeywordSearcher</span>

<div class="viewcode-block" id="EmergencyCaptionDialog">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EmergencyCaptionDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PySide6 dialog for building emergency slide payloads (Bible verses or custom messages).</span>

<span class="sd">    Supported features:</span>

<span class="sd">    - Bible reference input (e.g., &quot;요 3:16&quot;)</span>
<span class="sd">      - First Enter shows a preview generated by ``EmergencySlideFactory``.</span>
<span class="sd">      - Subsequent confirmation finalizes the previewed slides.</span>

<span class="sd">    - Keyword search against the selected Bible version</span>
<span class="sd">      - AND mode: all tokens must appear in a verse.</span>
<span class="sd">      - Compact mode: whitespace-insensitive substring match.</span>
<span class="sd">      - Double-clicking a result fills inputs and finalizes slides.</span>

<span class="sd">    - Non-Bible emergency slide generation</span>
<span class="sd">      - User chooses a slide style from ``style_map.STYLE_ALIASES``.</span>
<span class="sd">      - For preset-based styles (e.g., respo/hymn), numeric inputs can load presets.</span>
<span class="sd">      - Otherwise, a manual slide is created from caption/headline inputs.</span>

<span class="sd">    Generated slides are stored in ``self.finalized_slides`` and can be retrieved</span>
<span class="sd">    via ``get_final_slides()``.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        finalized_slides (list[dict]):</span>
<span class="sd">            Slide dictionaries generated by the most recent preview or confirmation.</span>
<span class="sd">        previewed_once (bool):</span>
<span class="sd">            Whether the Bible-reference preview has been shown at least once.</span>
<span class="sd">        versions (list[str]):</span>
<span class="sd">            Available Bible versions discovered from ``paths.BIBLE_DATA_DIR``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EmergencyCaptionDialog.__init__">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the emergency caption dialog UI and internal state.</span>

<span class="sd">        This constructs all widgets used for:</span>
<span class="sd">        - Bible reference input and preview</span>
<span class="sd">        - Keyword-based Bible search and result selection</span>
<span class="sd">        - Manual emergency message and style-based slide generation</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (QDialog | None):</span>
<span class="sd">                Optional parent widget for the dialog.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;대한예수교장로회(통합) 을지로교회 긴급자막 입력 시스템&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># --- Bible version selector ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;성경 선택&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span>
            <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">BIBLE_DATA_DIR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">DEFAULT_VERSION</span> <span class="o">=</span> <span class="s2">&quot;대한민국 개역개정 (1998)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEFAULT_VERSION</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">DEFAULT_VERSION</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># --- Input field for Bible reference ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input1</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input1</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;예: 요 3:16&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input1</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_verse_enter</span><span class="p">)</span>

        <span class="c1"># --- Preview output area (read-only) ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span> <span class="o">=</span> <span class="n">QTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;엔터를 누르면 성경말씀 미리보기가 여기에 표시됩니다.&quot;</span><span class="p">)</span>

        <span class="c1"># --- Input field for keyword search ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword_input</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword_input</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;예: 하나님이 세상을&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword_input</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_keyword_search</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">set_svg_icon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="p">,</span> <span class="n">get_icon_path</span><span class="p">(</span><span class="s2">&quot;search.svg&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_keyword_search</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span> <span class="o">=</span> <span class="n">QTableView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_model</span> <span class="o">=</span> <span class="n">KeywordResultTableModelLight</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_result_selected</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>

        <span class="c1"># --- Input field for additional message ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input2</span> <span class="o">=</span> <span class="n">QTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;예: 하나님이 세상을 이처럼 사랑하사...&quot;</span><span class="p">)</span>

        <span class="c1"># --- Button to confirm and output the emergency caption ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">set_svg_icon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="n">get_icon_path</span><span class="p">(</span><span class="s2">&quot;export.svg&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_confirm_clicked</span><span class="p">)</span>

        <span class="c1"># --- Style dropdown and caption input (input3) ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_dropdown</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style_dropdown</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">style_map</span><span class="o">.</span><span class="n">STYLE_ALIASES</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input3</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input3</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;제목 또는 번호 (예: 123)&quot;</span><span class="p">)</span>

        <span class="c1"># Horizontal layout for style + caption input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caption_row</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caption_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style_dropdown</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caption_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input3</span><span class="p">)</span>

        <span class="c1"># Insert caption row above the message input</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_label</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;성경 구절 검색&quot;</span><span class="p">))</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;키워드 검색&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_row</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_and</span> <span class="o">=</span> <span class="n">QRadioButton</span><span class="p">(</span><span class="s2">&quot;모두 포함&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_compact</span> <span class="o">=</span> <span class="n">QRadioButton</span><span class="p">(</span><span class="s2">&quot;붙여서 검색&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_and</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_group</span> <span class="o">=</span> <span class="n">QButtonGroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_and</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_compact</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_and</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_compact</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyword_input</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_row</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_row</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;기타 긴급 메시지&quot;</span><span class="p">))</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caption_row</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># --- Tracks whether preview has been shown ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previewed_once</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.get_inputs">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.get_inputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the current user inputs from the dialog.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[str, str]:</span>
<span class="sd">                A tuple containing:</span>
<span class="sd">                - The Bible reference or caption text from the first input field.</span>
<span class="sd">                - The emergency message or verse text from the message editor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input1</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.handle_verse_enter">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.handle_verse_enter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_verse_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle Enter key events in the Bible reference input field.</span>

<span class="sd">        On the first Enter press, this generates and displays a preview</span>
<span class="sd">        of the resolved Bible verse or caption.</span>
<span class="sd">        On subsequent Enter presses, the dialog is accepted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">previewed_once</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_preview</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previewed_once</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.handle_keyword_search">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.handle_keyword_search">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_keyword_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle Enter key events in the keyword search input field.</span>

<span class="sd">        If the keyword input is non-empty, this triggers a keyword-based</span>
<span class="sd">        Bible search using the current search mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keyword</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyword_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">keyword</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_keyword_search</span><span class="p">()</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.on_confirm_clicked">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.on_confirm_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_confirm_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finalize emergency slide generation and close the dialog.</span>

<span class="sd">        If the primary input is recognized as a Bible reference,</span>
<span class="sd">        a preview is generated if not already shown.</span>
<span class="sd">        Otherwise, non-Bible emergency slides are built directly.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input1</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parse_reference</span><span class="p">(</span><span class="n">line1</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">previewed_once</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_preview</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previewed_once</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_non_bible_slides</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.show_preview">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.show_preview">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate and display a preview of the emergency slides.</span>

<span class="sd">        This resolves the current inputs into slide data using</span>
<span class="sd">        EmergencySlideFactory and renders a text preview in the UI.</span>
<span class="sd">        Generated slides are stored internally for later retrieval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Retrieve input values</span>
        <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">EmergencySlideFactory</span><span class="p">()</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">slides</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_from_input</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">line2</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>

        <span class="c1"># Save generated slides (even if empty)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span> <span class="o">=</span> <span class="n">slides</span>

        <span class="c1"># Show warning message if no slides were created</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">slides</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="s2">&quot;⚠️ 말씀을 찾을 수 없습니다.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Compose preview content from slide data</span>
        <span class="n">preview_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">slide</span> <span class="ow">in</span> <span class="n">slides</span><span class="p">:</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;caption&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">headline</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">caption</span><span class="p">:</span>
                <span class="n">preview_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">caption</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">headline</span><span class="p">:</span>
                <span class="n">preview_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">headline</span><span class="p">)</span>
            <span class="n">preview_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Add spacing between slides</span>

        <span class="c1"># Disable second input if recognized as Bible reference</span>
        <span class="k">if</span> <span class="n">parse_reference</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="s2">&quot;(성경 구절로 인식되어 이 입력은 무시됩니다)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Display constructed preview</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">preview_lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">moveCursor</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">Start</span><span class="p">)</span>  <span class="c1"># Move to top</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.on_keyword_search">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.on_keyword_search">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_keyword_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a keyword-based Bible search.</span>

<span class="sd">        This searches the selected Bible version using the chosen</span>
<span class="sd">        search mode and populates the result table with matches.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keyword</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyword_input</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keyword</span> <span class="ow">or</span> <span class="n">keyword</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Determine search mode</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;compact&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_compact</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;and&quot;</span>

        <span class="c1"># Run keyword search using selected version</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">searcher</span> <span class="o">=</span> <span class="n">BibleKeywordSearcher</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

        <span class="c1"># Update result table and delegate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_model</span> <span class="o">=</span> <span class="n">KeywordResultTableModelLight</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">KeywordHighlightDelegate</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="n">keyword</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="o">.</span><span class="n">resizeRowsToContents</span><span class="p">()</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.on_result_selected">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.on_result_selected">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_result_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle selection of a Bible verse from the keyword search results.</span>

<span class="sd">        The selected verse reference and text are applied to the input fields,</span>
<span class="sd">        emergency slides are generated, and the dialog is accepted.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (QModelIndex):</span>
<span class="sd">                Model index corresponding to the selected table row.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>

        <span class="c1"># Get data from selected row</span>
        <span class="n">ref_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">text_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">caption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ref_index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="n">headline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">text_index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>

        <span class="c1"># Apply selected content to inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">headline</span><span class="p">)</span>

        <span class="c1"># Generate slides and accept dialog</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">EmergencySlideFactory</span><span class="p">()</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_from_input</span><span class="p">(</span><span class="n">caption</span><span class="p">,</span> <span class="n">headline</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.build_non_bible_slides">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.build_non_bible_slides">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_non_bible_slides</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build emergency slides from manual inputs and selected style.</span>

<span class="sd">        Depending on the chosen style and caption input, this may:</span>
<span class="sd">        - Load a preset responsive reading or hymn slide.</span>
<span class="sd">        - Create a manual emergency slide with custom caption and text.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">core.config.style_map</span><span class="w"> </span><span class="kn">import</span> <span class="n">REVERSE_ALIASES</span>

        <span class="c1"># Gather user inputs</span>
        <span class="n">caption_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input3</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">headline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input2</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">style_display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style_dropdown</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">style_code</span> <span class="o">=</span> <span class="n">REVERSE_ALIASES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">style_display</span><span class="p">,</span> <span class="s2">&quot;verse&quot;</span><span class="p">)</span>

        <span class="n">factory</span> <span class="o">=</span> <span class="n">EmergencySlideFactory</span><span class="p">()</span>

        <span class="c1"># Create responsive reading slide if applicable</span>
        <span class="k">if</span> <span class="n">style_code</span> <span class="o">==</span> <span class="s2">&quot;respo&quot;</span> <span class="ow">and</span> <span class="n">caption_input</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_from_respo</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">caption_input</span><span class="p">))</span>

        <span class="c1"># Create hymn slide if applicable</span>
        <span class="k">elif</span> <span class="n">style_code</span> <span class="o">==</span> <span class="s2">&quot;hymn&quot;</span> <span class="ow">and</span> <span class="n">caption_input</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_from_hymn</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">caption_input</span><span class="p">))</span>

        <span class="c1"># Create manual slide with input text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use fallback caption if none provided</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">caption_input</span> <span class="ow">and</span> <span class="n">headline</span><span class="p">:</span>
                <span class="n">caption_input</span> <span class="o">=</span> <span class="s2">&quot;대한예수교장로회(통합) 을지로교회&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_manual_slide</span><span class="p">(</span>
                <span class="n">style</span><span class="o">=</span><span class="n">style_code</span><span class="p">,</span>
                <span class="n">caption</span><span class="o">=</span><span class="n">caption_input</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">headline</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="EmergencyCaptionDialog.get_final_slides">
<a class="viewcode-back" href="../../../controller.ui.html#controller.ui.emergency_caption_dialog.EmergencyCaptionDialog.get_final_slides">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_final_slides</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of finalized slides generated from the last preview.</span>

<span class="sd">        This method provides access to the slide data created during the most recent</span>
<span class="sd">        call to `show_preview()` or `build_non_bible_slides()`. These slides reflect the</span>
<span class="sd">        selected Bible version and parsed reference or manual input.</span>

<span class="sd">        Returns:</span>
<span class="sd">                list[dict]:</span>
<span class="sd">                    A list of slide dictionaries generated by the most recent</span>
<span class="sd">                    preview, selection, or manual build operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalized_slides</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Benjamin J. Choi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>